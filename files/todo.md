# REBAスコア算出Webアプリ開発 Todoリスト

## I. プロジェクト設定と基本構造

-   [x] 開発ディレクトリ構造の作成 (例: `reba_app_v2/frontend`, `reba_app_v2/backend`)
-   [x] フロントエンドの基本HTML、CSS、JavaScriptファイルの作成
-   [x] バックエンド(FastAPI)の基本設定、エントリーポイント作成
-   [x] Mediapipe Poseのフロントエンドへの組み込み準備

## II. フロントエンド開発

-   [x] **カメラアクセスと映像表示**
    -   [x] ユーザーにカメラ使用許可を求める
    -   [x] カメラ映像をHTMLのvideo要素にストリーミング表示
-   [x] **Mediapipe Pose連携**
    -   [x] Mediapipe Poseモデルのロードと設定
    -   [x] リアルタイムでの姿勢ランドマーク検出
    -   [x] 検出されたランドマークの描画（デバッグ用、オプション）
    -   [x] 必要な関節座標の抽出と整形
-   [x] **UIコンポーネント実装**
    -   [x] リアルタイムREBAスコア表示エリア
    -   [x] REBAスコアの時系列グラフ表示エリア (例: Chart.jsなどライブラリ利用)
    -   [x] 解析開始・停止ボタン
    -   [x] **手入力用UIコンポーネント (ラジオボタン、スライダー等)**
        -   [x] 撮影側（左/右）
        -   [x] 頸部：回旋あり/なし、側屈あり/なし
        -   [x] 体幹：側屈あり/なし、ねじりあり/なし (ねじりは手入力)
        -   [x] 荷重/力 (5kg未満, 5-10kg, 10kg超)
        -   [x] 衝撃力/急激な力あり/なし
        -   [x] 作業姿勢 (立位-両足支持, 立位-片足/不安定, 座位) (作業姿勢はまだ手入力UIにないが、既存アプリにはあった項目。必要に応じて追加検討)
        -   [x] 支持脚 (片足立ちの場合) (同上)
        -   [x] 上肢：肩の挙上あり/なし、上腕の外転あり/なし
        -   [x] 前腕：回旋あり/なし (手入力)
        -   [x] 手首：掌屈/背屈、尺屈/橈屈、回旋 (回旋は手入力)
        -   [x] カップリングスコア
        -   [x] 活動スコア（繰り返し頻度など）
-   [x] **データ送信処理**
    -   [x] 1秒ごとに姿勢ランドマークと手入力データをバックエンドに送信 (Fetch API / XMLHttpRequest)
-   [x] **結果受信と表示更新**
    -   [x] バックエンドからREBAスコアとリスクレベルを受信
    -   [x] スコア表示とグラフを更新
-   [x] **高スコア場面の動画クリップ機能**
    -   [x] バックエンドからの指示で短い動画クリップを録画 (MediaRecorder API)
    -   [x] 録画されたクリップの一覧表示と再生機能
-   [x] **レスポンシブデザイン**
    -   [x] スマートフォンでの表示と操作性の最適化 (CSS調整実施)

## III. バックエンド開発 (FastAPI)

-   [x] **APIエンドポイント定義 (`/calculate_reba`)**
    -   [x] Pydanticモデルによるリクエストボディの定義 (姿勢ランドマーク、手入力データ)
    -   [x] Pydanticモデルによるレスポンスボディの定義 (REBAスコア、各部位スコア、リスクレベル、高スコアフラグ)
-   [ ] **REBAスコア計算ロジック**
    -   [x] **角度計算モジュール** (既存コードを参考に改善・拡張)
        -   [x] 頸部角度 (屈曲/伸展、側屈、回旋) (基本実装済み)
        -   [x] 体幹角度 (屈曲/伸展、側屈、回旋) (基本実装済み)
        -   [ ] 脚角度 (股関節、膝関節、足関節) (膝角度のみ実装、他は未実装または手入力依存)
        -   [x] 上腕角度 (肩関節の屈曲/伸展、外転/内転、挙上) (基本実装済み)
        -   [x] 前腕角度 (肘関節の屈曲/伸展、回旋) (屈曲は実装済み、回旋の手入力反映を強化)
        -   [x] 手首角度 (掌屈/背屈、尺屈/橈屈、回旋) (基本実装済み、偏位・回旋の手入力反映を強化)
        -   [x] ランドマークのvisibilityを考慮した角度計算の改善（特に体幹と肩関節）(基本実装済み)
    -   [x] **REBAスコアシートに基づくスコアリング**
        -   [x] 各部位のスコアテーブル実装 (ダミーテーブル使用中、要検証・改善)
        -   [x] 表A (体幹、頸部、脚) スコア算出 (実装済み)
        -   [x] 表B (上腕、前腕、手首) スコア算出 (実装済み)
        -   [x] 荷重/力スコアの加算 (実装済み)
        -   [x] 表Cスコア算出 (表Aスコア + 荷重スコア と 表Bスコアから) (実装済み)
        -   [x] カップリングスコアの加算 (実装済み)
        -   [x] 活動スコアの加算 (実装済み)
        -   [x] 最終REBAスコアとリスクレベル判定 (実装済み)
        -   [x] 手入力データのスコアへの反映 (実装済み、前腕・手首の反映を強化)
-   [ ] **高スコア判定ロジック**
    -   [x] スコアが特定の閾値を超えた場合に高スコアフラグを立てる (基本実装済み) [ ] **(オプション) データ永続化**
    -   [ ] 時系列スコアデータの保存 (DB or ファイル)
    -   [ ] 高スコア動画クリップのメタデータ保存 (DB or ファイル)

## IV. 統合とテスト

-   [ ] フロントエンドとバックエンドの連携テスト
-   [ ] **精度検証**
    -   [ ] 様々な姿勢でのREBAスコア算出結果の妥当性確認
    -   [ ] 特に体幹と肩関節の角度推定精度の確認と改善
    -   [ ] visibilityが低い場合の挙動確認
-   [ ] **スマートフォンでの実機テスト**
    -   [ ] iOSおよびAndroidの主要ブラウザでの動作確認
    -   [ ] パフォーマンス確認
    -   [ ] UI/UXの確認
-   [ ] バグ修正と最終調整

## V. デプロイとドキュメント

-   [ ] デプロイ準備 (Render.comなど、既存のプラットフォームを想定)
-   [ ] 簡単な使用方法のドキュメント作成
-   [ ] ユーザーへの成果物提出

